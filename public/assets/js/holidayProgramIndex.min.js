function initializeProgramStatusMonitoring(){document.querySelectorAll(".program-card").forEach(t=>{addLoadingStateSupport(t),addInteractiveEffects(t),monitorCapacityUpdates(t),addClickTracking(t)})}function addLoadingStateSupport(t){const n=t.querySelector(".register-btn"),e=t.querySelector(".details-link");n&&!n.classList.contains("disabled")&&n.addEventListener("click",function(t){if(this.getAttribute("href")&&!this.classList.contains("disabled")){this.classList.add("loading");const t=this.innerHTML;this.innerHTML='<i class="fas fa-spinner fa-spin"></i> Loading...',setTimeout(()=>{this.classList.contains("loading")&&(this.classList.remove("loading"),this.innerHTML=t)},5e3)}}),e&&e.addEventListener("click",function(t){this.classList.add("loading");const n=this.innerHTML;this.innerHTML='<i class="fas fa-spinner fa-spin"></i> Loading...',setTimeout(()=>{this.classList.contains("loading")&&(this.classList.remove("loading"),this.innerHTML=n)},5e3)})}function addInteractiveEffects(t){let n;t.addEventListener("mouseenter",function(){clearTimeout(n),this.classList.contains("loading")||(this.style.transition="transform 0.3s ease, box-shadow 0.3s ease",this.style.transform="translateY(-8px)",this.style.boxShadow="0 20px 40px rgba(0, 0, 0, 0.15)")}),t.addEventListener("mouseleave",function(){clearTimeout(n),n=setTimeout(()=>{this.classList.contains("loading")||(this.style.transform="translateY(0)",this.style.boxShadow="0 8px 25px rgba(0, 0, 0, 0.1)")},100)});t.querySelectorAll(".register-btn, .details-link").forEach(t=>{t.addEventListener("click",function(t){this.classList.contains("disabled")||createRippleEffect(t,this)})})}function monitorCapacityUpdates(t){const n=t.querySelector(".capacity-fill"),e=t.querySelector(".capacity-text");if(n&&e){const i={id:extractProgramId(t),originalWidth:n.style.width,originalText:e.textContent};i.id&&setInterval(()=>{checkCapacityUpdates(t,n,e,i)},45e3)}}function checkCapacityUpdates(t,n,e,i){i.id&&!document.hidden&&fetch(`./api/get-program-capacity.php?program_id=${i.id}`).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).then(a=>{a.success&&a.capacity_info&&(updateCapacityDisplay(n,e,a.capacity_info),(a.status_changed||a.registration_open!==getCurrentRegistrationStatus(t))&&updateProgramStatus(t,{registration_open:a.registration_open,program_id:i.id,has_details:!0}))}).catch(t=>{console.log("Capacity check failed for program",i.id,":",t.message)})}function getCurrentRegistrationStatus(t){const n=t.querySelector(".register-btn");return n&&n.classList.contains("active")}function updateCapacityDisplay(t,n,e){const i=e.max>0?e.current/e.max*100:0,a=Math.min(i,100)+"%",o=`${e.current}/${e.max} participants`;t.style.width!==a&&(t.style.transition="width 0.8s ease, background 0.3s ease",t.style.width=a,n.style.transition="opacity 0.3s ease",n.style.opacity="0.5",setTimeout(()=>{n.textContent=o,n.style.opacity="1"},150),updateCapacityColor(t,i),i>=90&&i<100&&showCapacityWarning(e))}function updateCapacityColor(t,n){n>=100?(t.style.background="linear-gradient(90deg, #dc3545, #e74c3c)",t.classList.add("capacity-full")):n>=90?(t.style.background="linear-gradient(90deg, #fd7e14, #dc3545)",t.classList.add("capacity-warning")):n>=75?(t.style.background="linear-gradient(90deg, #ffc107, #fd7e14)",t.classList.remove("capacity-warning","capacity-full")):(t.style.background="linear-gradient(90deg, #28a745, #20c997)",t.classList.remove("capacity-warning","capacity-full"))}function showCapacityWarning(t){const n=`capacity_warning_${t.current}_${t.max}`;sessionStorage.getItem(n)||(sessionStorage.setItem(n,"shown"),showStatusChangeNotification(`Program is almost full! Only ${t.max-t.current} spots remaining.`,"warning"))}function updateProgramStatus(t,n){const e=t.querySelector(".status-badge"),i=t.querySelector(".register-btn"),a=t.querySelector(".details-link"),o=n.program_id;t.classList.add("status-updating"),setTimeout(()=>{n.registration_open?(e&&(e.className="status-badge open",e.textContent="Registration Open"),i&&(i.className="register-btn active",i.textContent="Register Now",i.href=`holidayProgramRegistration.php?program_id=${o}`,i.removeAttribute("disabled")),t.classList.remove("registration-closed"),t.classList.add("registration-open"),showStatusChangeNotification("Registration is now open! ðŸŽ‰","success")):(e&&(e.className="status-badge closed",e.textContent="Registration Closed"),i&&(i.className="register-btn disabled",i.textContent="Registration Closed",i.removeAttribute("href"),i.setAttribute("disabled","true")),t.classList.remove("registration-open"),t.classList.add("registration-closed"),showStatusChangeNotification("Registration has been closed","info")),a&&(a.style.display=n.has_details?"inline-block":"none"),t.classList.remove("status-updating")},300)}function showStatusChangeNotification(t,n){document.querySelectorAll(`.status-notification.${n}`).forEach(t=>{t.style.animation="slideOutRight 0.3s ease",setTimeout(()=>t.remove(),300)});const e=document.createElement("div");e.className=`status-notification ${n}`,e.innerHTML=`\n        <div class="notification-content">\n            <i class="fas fa-${getNotificationIcon(n)}"></i>\n            <span class="notification-message">${t}</span>\n            <button class="notification-close" onclick="this.parentElement.parentElement.remove()">\n                <i class="fas fa-times"></i>\n            </button>\n        </div>\n    `,e.style.cssText=`\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        z-index: 10000;\n        padding: 15px 20px;\n        border-radius: 12px;\n        color: white;\n        font-weight: 600;\n        min-width: 320px;\n        max-width: 400px;\n        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);\n        animation: slideInRight 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);\n        background: ${getNotificationColor(n)};\n        backdrop-filter: blur(10px);\n        border: 1px solid rgba(255, 255, 255, 0.1);\n    `,document.body.appendChild(e),setTimeout(()=>{e.parentNode&&(e.style.animation="slideOutRight 0.4s ease",setTimeout(()=>{e.parentNode&&e.remove()},400))},6e3),e.addEventListener("click",()=>{e.style.animation="slideOutRight 0.3s ease",setTimeout(()=>e.remove(),300)})}function getNotificationIcon(t){return{success:"check-circle",info:"info-circle",warning:"exclamation-triangle",error:"exclamation-circle",capacity:"users"}[t]||"info-circle"}function getNotificationColor(t){const n={success:"linear-gradient(135deg, #28a745, #20c997)",info:"linear-gradient(135deg, #17a2b8, #138496)",warning:"linear-gradient(135deg, #ffc107, #fd7e14)",error:"linear-gradient(135deg, #dc3545, #c82333)",capacity:"linear-gradient(135deg, #6f42c1, #e83e8c)"};return n[t]||n.info}function createRippleEffect(t,n){const e=document.createElement("span"),i=n.getBoundingClientRect(),a=Math.max(i.width,i.height),o=t.clientX-i.left-a/2,s=t.clientY-i.top-a/2;e.style.cssText=`\n        position: absolute;\n        width: ${a}px;\n        height: ${a}px;\n        left: ${o}px;\n        top: ${s}px;\n        background: rgba(255, 255, 255, 0.5);\n        border-radius: 50%;\n        transform: scale(0);\n        animation: ripple 0.6s linear;\n        pointer-events: none;\n        z-index: 1;\n    `;const r=n.style.position;n.style.position="relative",n.style.overflow="hidden",n.appendChild(e),setTimeout(()=>{e.remove(),r||(n.style.position="")},600)}function extractProgramId(t){const n=t.querySelector(".register-btn[href]");if(n&&n.href){const t=new URL(n.href,window.location.origin).searchParams.get("program_id");if(t)return t}const e=t.querySelector(".details-link[href]");if(e&&e.href){return new URL(e.href,window.location.origin).searchParams.get("id")}const i=t.getAttribute("data-program-id");return i||null}function addClickTracking(t){t.querySelectorAll(".register-btn, .details-link").forEach(n=>{n.addEventListener("click",function(n){const e=extractProgramId(t),i=this.classList.contains("register-btn")?"register":"details";console.log(`Button clicked: ${i} for program ${e}`)})})}function initializeUIInteractions(){document.querySelectorAll('a[href^="#"]').forEach(t=>{t.addEventListener("click",function(t){t.preventDefault();const n=this.getAttribute("href").substring(1),e=document.getElementById(n);if(e){const t=80,n=e.getBoundingClientRect().top+window.pageYOffset-t;window.scrollTo({top:n,behavior:"smooth"})}})});document.querySelectorAll('nav a:not([href^="#"]), .cta-button:not([href^="#"])').forEach(t=>{t.addEventListener("click",function(){if(this.getAttribute("href")&&!this.classList.contains("loading")){this.classList.add("loading");const t=this.innerHTML;this.innerHTML='<i class="fas fa-spinner fa-spin"></i> Loading...',setTimeout(()=>{this.classList.contains("loading")&&(this.classList.remove("loading"),this.innerHTML=t)},3e3)}})})}function initializeScrollAnimations(){const t=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting&&(t.target.classList.add("animate-in"),t.target.classList.contains("program-card"))){const n=document.querySelectorAll(".program-card"),e=Array.from(n).indexOf(t.target);t.target.style.animationDelay=.1*e+"s"}})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".program-card, .feature-card, .section-header").forEach(n=>{t.observe(n)})}function handleVisibilityChanges(){document.addEventListener("visibilitychange",()=>{document.hidden||(console.log("Page visible - checking for updates"),checkForGlobalStatusUpdates())})}function startStatusPolling(){setTimeout(checkForGlobalStatusUpdates,2e3),setInterval(()=>{document.hidden||checkForGlobalStatusUpdates()},6e4)}function checkForGlobalStatusUpdates(){const t=sessionStorage.getItem("last_status_check")||new Date(Date.now()-36e5).toISOString();fetch(`./api/get-all-program-status.php?last_check=${encodeURIComponent(t)}`).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).then(t=>{t.success&&(sessionStorage.setItem("last_status_check",t.timestamp),t.updates&&t.updates.length>0&&t.updates.forEach(t=>{const n=findProgramCard(t.program_id);n&&updateProgramStatus(n,t)}),t.capacity_warnings&&t.capacity_warnings.length>0&&t.capacity_warnings.forEach(t=>{showStatusChangeNotification(t.message,"capacity")}))}).catch(t=>{console.log("Status check failed:",t.message)})}function findProgramCard(t){const n=document.querySelectorAll(".program-card");for(let e of n){if(extractProgramId(e)==t)return e}return null}document.addEventListener("DOMContentLoaded",function(){initializeProgramStatusMonitoring(),initializeUIInteractions(),startStatusPolling(),initializeScrollAnimations(),handleVisibilityChanges()}),window.addEventListener("online",()=>{showStatusChangeNotification("Connection restored","success"),setTimeout(checkForGlobalStatusUpdates,1e3)}),window.addEventListener("offline",()=>{showStatusChangeNotification("No internet connection - updates may be delayed","warning")}),window.addEventListener("beforeunload",()=>{document.querySelectorAll(".loading").forEach(t=>{t.classList.remove("loading")})});const style=document.createElement("style");style.textContent="\n    @keyframes slideInRight {\n        from {\n            transform: translateX(100%);\n            opacity: 0;\n        }\n        to {\n            transform: translateX(0);\n            opacity: 1;\n        }\n    }\n    \n    @keyframes slideOutRight {\n        from {\n            transform: translateX(0);\n            opacity: 1;\n        }\n        to {\n            transform: translateX(100%);\n            opacity: 0;\n        }\n    }\n    \n    @keyframes ripple {\n        to {\n            transform: scale(4);\n            opacity: 0;\n        }\n    }\n    \n    @keyframes animate-in {\n        from {\n            opacity: 0;\n            transform: translateY(30px);\n        }\n        to {\n            opacity: 1;\n            transform: translateY(0);\n        }\n    }\n    \n    @keyframes pulse-warning {\n        0%, 100% { opacity: 1; }\n        50% { opacity: 0.7; }\n    }\n    \n    @keyframes status-update {\n        0% { transform: scale(1); }\n        50% { transform: scale(1.02); }\n        100% { transform: scale(1); }\n    }\n    \n    /* Enhanced animations */\n    .animate-in {\n        animation: animate-in 0.6s ease forwards;\n    }\n    \n    .loading {\n        pointer-events: none;\n        opacity: 0.7;\n        cursor: wait !important;\n    }\n    \n    .status-updating {\n        animation: status-update 0.6s ease;\n    }\n    \n    .notification-content {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n    }\n    \n    .notification-message {\n        flex: 1;\n        line-height: 1.4;\n    }\n    \n    .notification-close {\n        background: none;\n        border: none;\n        color: white;\n        cursor: pointer;\n        padding: 8px;\n        margin: -4px;\n        border-radius: 6px;\n        transition: background 0.3s ease;\n        opacity: 0.8;\n    }\n    \n    .notification-close:hover {\n        background: rgba(255, 255, 255, 0.2);\n        opacity: 1;\n    }\n    \n    /* Enhanced button states */\n    .register-btn.loading,\n    .details-link.loading {\n        cursor: wait !important;\n        transform: none !important;\n        pointer-events: none;\n    }\n    \n    .program-card.loading {\n        pointer-events: none;\n        filter: brightness(0.95);\n    }\n    \n    /* Capacity states */\n    .capacity-fill.capacity-warning {\n        animation: pulse-warning 2s infinite;\n    }\n    \n    .capacity-fill.capacity-full {\n        animation: pulse-warning 1s infinite;\n    }\n    \n    /* Status badge enhanced animations */\n    .status-badge.open {\n        animation: pulse-success 3s infinite;\n    }\n    \n    @keyframes pulse-success {\n        0% { \n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), 0 0 0 0 rgba(40, 167, 69, 0.7); \n        }\n        70% { \n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), 0 0 0 10px rgba(40, 167, 69, 0); \n        }\n        100% { \n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), 0 0 0 0 rgba(40, 167, 69, 0); \n        }\n    }\n    \n    /* Improved hover effects */\n    .program-card:hover .register-btn.active {\n        transform: translateY(-2px);\n        box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);\n    }\n    \n    .program-card:hover .details-link {\n        transform: translateY(-1px);\n        border-color: #495057;\n    }\n    \n    /* Mobile optimizations */\n    @media (max-width: 768px) {\n        .status-notification {\n            right: 10px !important;\n            left: 10px !important;\n            min-width: auto !important;\n            max-width: none !important;\n        }\n        \n        .notification-content {\n            font-size: 14px;\n            gap: 8px;\n        }\n        \n        .notification-message {\n            font-size: 13px;\n        }\n        \n        /* Reduce animation intensity on mobile */\n        .program-card:hover {\n            transform: translateY(-4px) !important;\n        }\n    }\n    \n    /* Reduced motion support */\n    @media (prefers-reduced-motion: reduce) {\n        .animate-in,\n        .status-updating,\n        .program-card,\n        .capacity-fill,\n        .status-badge {\n            animation: none !important;\n            transition: none !important;\n        }\n        \n        .program-card:hover {\n            transform: none !important;\n        }\n    }\n    \n    /* High contrast mode support */\n    @media (prefers-contrast: high) {\n        .status-notification {\n            border: 2px solid white;\n        }\n        \n        .notification-close {\n            border: 1px solid rgba(255, 255, 255, 0.5);\n        }\n    }\n",document.head.appendChild(style),window.addEventListener("error",t=>{console.error("JavaScript error:",t.error)}),window.addEventListener("unhandledrejection",t=>{console.error("Unhandled promise rejection:",t.reason)}),console.log("Holiday Program Index JS initialized successfully");